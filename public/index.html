<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BlocksMC Tracker</title>
    <link rel="icon" type="image/png" href="Trackericon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ---------- Base Styles ---------- */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      overflow-x: hidden;
      background-color: #e9f0f5;
      color: #333;
    }
    body.dark-theme {
      background-color: #121212;
      color: #ddd;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      position: relative;
      z-index: 1;
    }
    body.dark-theme .container {
      background: #1e1e1e;
      box-shadow: 0 8px 16px rgba(0,0,0,0.7);
    }
    /* ---------- Header Design with Rainbow Text and Icon ---------- */
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    header h1 {
      font-size: 2.8em;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    header h1 .icon {
      width: 32px;
      height: 32px;
    }
    header h1 .rainbow {
      background: linear-gradient(90deg, #ff416c, #ff4b2b, #ff416c);
      background-size: 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow 3s linear infinite;
    }
    @keyframes rainbow {
      0% { background-position: 0%; }
      100% { background-position: 100%; }
    }
    header p {
      font-size: 1.2em;
      color: #777;
      margin: 8px 0 0 0;
    }
    body.dark-theme header p {
      color: #aaa;
    }
    /* ---------- Form Elements ---------- */
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    body.dark-theme input[type="text"] {
      background: #333;
      border: 1px solid #555;
      color: #fff;
    }
    /* ---------- Lime-Themed Buttons ---------- */
    button {
      background-color: #32CD32;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    button:hover:not(:disabled) {
      background-color: #2eb82e;
      transform: scale(1.03);
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
      transform: none;
    }
    body.dark-theme button {
      background-color: #32CD32;
    }
    body.dark-theme button:hover:not(:disabled) {
      background-color: #2eb82e;
    }
    /* ---------- Log Area ---------- */
    .ban-log {
      margin-top: 20px;
      padding: 15px;
      background: #fdf6ec;
      border: 1px solid #f0d8b5;
      border-radius: 6px;
    }
    body.dark-theme .ban-log {
      background: #2c2c2c;
      border: 1px solid #555;
      color: #ccc;
    }
    .ban-log h2 {
      margin-top: 0;
    }
    .ban-log ul {
      list-style: none;
      padding-left: 0;
    }
    .ban-log li {
      margin-bottom: 6px;
      font-size: 14px;
    }
    /* ---------- Info Areas ---------- */
    #lastCheckInfo {
      margin-bottom: 20px;
      padding: 12px;
      background: #e1f5fe;
      border: 1px solid #81d4fa;
      border-radius: 6px;
    }
    body.dark-theme #lastCheckInfo {
      background: #2a2a2a;
      border: 1px solid #555;
      color: #ccc;
    }
    #prevContainer {
      margin-top: 20px;
      background: #f1f8e9;
      border: 1px solid #dcedc8;
      border-radius: 6px;
      padding: 12px;
      transition: transform 0.5s ease-out, opacity 0.5s ease-out;
    }
    body.dark-theme #prevContainer {
      background: #2a2a2a;
      border: 1px solid #555;
      color: #ccc;
    }
    #prevContainer h2 {
      margin: 0 0 10px 0;
      font-size: 1.5em;
      text-align: center;
    }
    .prevEntry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #ddd;
      padding: 8px 0;
    }
    body.dark-theme .prevEntry {
      border-bottom: 1px solid #555;
    }
    .prevEntry:last-child {
      border-bottom: none;
    }
    .prevUsername {
      font-weight: bold;
    }
    .prevStatus {
      padding: 4px 8px;
      border-radius: 4px;
      color: #fff;
      margin-right: 10px;
      font-size: 0.9em;
    }
    .statusNotBanned { background: green; }
    .statusBanned { background: red; }
    .statusChecking { background: orange; }
    .statusLoggedIn { background: yellow; color: #333; }
    .prevCount {
      font-size: 0.8em;
      color: #666;
    }
    .recheckBtn {
      background-color: #32CD32;
      border: none;
      padding: 8px 14px;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .recheckBtn:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    /* ---------- Reset Cookies Button ---------- */
    .reset-cookies-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #32CD32;
      color: white;
      border: none;
      padding: 10px 15px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1100;
    }
    .reset-cookies-btn:hover {
      background-color: #2eb82e;
    }
    /* ---------- Warning Note (Increased Size) ---------- */
    .download-note {
      margin-top: 20px;
      padding: 20px;
      background-color: #ffebee;
      border: 2px solid #f44336;
      border-radius: 8px;
      color: #d32f2f;
      font-weight: bold;
      text-align: center;
      font-size: 1em;
    }
    /* ---------- FAQ Section with Simple Accordion ---------- */
    .faq-section {
      background: #fff;
      color: #333;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid #ccc;
    }
    body.dark-theme .faq-section {
      background: #1e1e1e;
      color: #ddd;
      border: 1px solid #555;
    }
    .faq-section h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .faq-item {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .faq-item:last-child {
      border-bottom: none;
    }
    .faq-item summary {
      cursor: pointer;
      font-size: 1.1em;
      outline: none;
      font-weight: bold;
    }
    .faq-item p {
      margin-top: 10px;
      padding-left: 20px;
      line-height: 1.4;
    }
    /* ---------- Floating Hearts (for Dark Theme Accent) ---------- */
    #heartsContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      pointer-events: none;
      z-index: 100;
    }
    body:not(.dark-theme) #heartsContainer {
      display: none;
    }
    .heart {
      position: absolute;
      width: 40px;
      height: auto;
      opacity: 0.8;
      animation: floatHearts 8s ease-in-out infinite;
    }
    @keyframes floatHearts {
      0% { transform: translateY(-20px) scale(0.8); opacity: 0; }
      20% { opacity: 1; }
      50% { transform: translateY(150px) scale(1); opacity: 0.8; }
      100% { transform: translateY(300px) scale(0.8); opacity: 0; }
    }
    .heart:nth-child(1) { left: 10%; animation-delay: 0s; }
    .heart:nth-child(2) { left: 40%; animation-delay: 2s; }
    .heart:nth-child(3) { left: 70%; animation-delay: 4s; }
    .heart:nth-child(4) { left: 85%; animation-delay: 6s; }
    @media (max-width: 600px) {
      .container { padding: 15px; }
      header h1 { font-size: 2em; }
      button { font-size: 14px; padding: 10px 16px; }
    }
  </style>
</head>
<body class="dark-theme">
  <!-- Theme Toggle Button (Top Left) -->
  <div id="themeToggle" style="position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.5); color:#fff; padding:8px 12px; border-radius:4px; cursor:pointer;">Theme: Dark</div>
  
  <!-- Floating Hearts (Visible in Dark Theme) -->
  <div id="heartsContainer">
    <img src="pinkheart.png" alt="Heart" class="heart">
    <img src="pinkheart.png" alt="Heart" class="heart">
    <img src="pinkheart.png" alt="Heart" class="heart">
    <img src="pinkheart.png" alt="Heart" class="heart">
  </div>
  
  <!-- Reset Cookies Button -->
  <button id="resetCookiesBtn" class="reset-cookies-btn">Erase Usernames</button>
  
  <div class="container">
    <header>
      <h1>
        <img src="TrackerIcon.png" alt="Icon" class="icon">
        <span class="rainbow">BlocksMC Ban Tracker Website</span>
      </h1>
      <p>Ban Tracker Only – Want full features? Download our Electron app!</p>
    </header>
    
    <!-- Last Check Info -->
    <div id="lastCheckInfo" style="display:none;"></div>
    
    <!-- Username Ban Checker -->
    <label for="username">Enter a username:</label>
    <input type="text" id="username" placeholder="Enter username" maxlength="16">
    <button id="checkBtn">Check Status</button>
    
    <div class="ban-log" id="banLog">
      <h2>Ban Log</h2>
      <ul id="logList"></ul>
    </div>
    
    <!-- Previous Usernames Section -->
    <div id="prevContainer" style="display:none;">
      <h2>Previous Usernames</h2>
      <div id="prevList"></div>
    </div>
    
    <!-- Warning Note (Bigger) -->
    <div class="download-note">
      Warning: This website gets updates but does not support OG username tracker because it uses our IP (subject to anti-VPN detection). For improved stability with a dedicated IP and full features, please download our Electron app.
    </div>
    
    <!-- FAQ Section -->
    <div class="faq-section">
      <h2>FAQ</h2>
      <details class="faq-item">
        <summary>What should I do if a player isn’t banned but I faked a clip of him?</summary>
        <div class="faq-content">
          <p>Wait for a moderator and ensure that when you faked the clip you used a second instance of Minecraft via a bot, and that you spoofed your bot’s username into your target’s name—making the clip look legitimate with a similar skin.</p>
        </div>
      </details>
      <details class="faq-item">
        <summary>What should I do if I got banned for faking another player's clip, even though they weren't?</summary>
        <div class="faq-content">
          <p>You likely provided the wrong in-game name or clip. If you faked the clip—or tried to report a moderator—they may still ban you permanently.</p>
        </div>
      </details>
      <details class="faq-item">
        <summary>Why can't we check a premium account status if it is banned?</summary>
        <div class="faq-content">
          <p>BlocksMC applied a patch that prevents direct premium status checks. Instead, we track playtime changes to determine if an account is banned.</p>
        </div>
      </details>
      <details class="faq-item">
        <summary>How to get someone banned?</summary>
        <div class="faq-content">
          <p>Download a name and skin spoofer mod—or use Vape V4—record a clip with your bot instance and report via blocksmc.com/report. This typically works only on default-ranked players.</p>
        </div>
      </details>
      <details class="faq-item">
        <summary>How to use name spoofer in VAPE V4 against your second bot instance?</summary>
        <div class="faq-content">
          <p>Add your bot's username as a friend (e.g., "nwath FakeUsername") so that it changes. If it fails, try enabling spoofAlias in settings.</p>
          <iframe width="254" height="268" src="https://www.youtube.com/embed/7sg4dCT8d8M" title="Tutorial: Spoof your username" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </details>
      <details class="faq-item">
        <summary>Why does this application have two themes: Dark and Light?</summary>
        <div class="faq-content">
          <p>We offer Dark for a modern look and Light for a classic feel – choose the one that suits you best.</p>
        </div>
      </details>
      <details class="faq-item">
        <summary>Why build this application if ban status can be checked through Minecraft?</summary>
        <div class="faq-content">
          <p>It provides instant access, advanced tracking, and continuous monitoring without needing an alt manager.</p>
        </div>
      </details>
    </div>
  </div>
  
  <!-- Audio elements for sound effects -->
  <audio id="buttonSound" src="buttonOnPressed.ogg" preload="auto"></audio>
  <audio id="errorSound" src="Error.ogg" preload="auto"></audio>
  <audio id="unbannedSound" src="StatusPlayerUnbanned.ogg" preload="auto"></audio>
  
  <script>
    // ---------- Storage Utility Functions ----------
    function setCookie(name, value, days) {
      localStorage.setItem(name, value);
    }
    function getCookie(name) {
      return localStorage.getItem(name);
    }
    
    // ---------- Theme Toggle Functions ----------
    function updateTheme() {
      var dark = getCookie("darkTheme");
      if (dark === "true") {
        document.body.classList.add("dark-theme");
        document.body.classList.remove("light-theme");
        document.getElementById("themeToggle").textContent = "Theme: Dark";
      } else {
        document.body.classList.remove("dark-theme");
        document.body.classList.add("light-theme");
        document.getElementById("themeToggle").textContent = "Theme: Light";
      }
    }
    function toggleTheme() {
      var dark = getCookie("darkTheme");
      setCookie("darkTheme", dark === "true" ? "false" : "true", 7);
      updateTheme();
    }
    updateTheme();
    document.getElementById("themeToggle").addEventListener("click", toggleTheme);
    
    const colorMap = {
      black: '#000000',
      dark_blue: '#0000AA',
      dark_green: '#00AA00',
      dark_aqua: '#00AAAA',
      dark_red: '#AA0000',
      dark_purple: '#AA00AA',
      gold: '#FFAA00',
      gray: '#AAAAAA',
      grey: '#AAAAAA',
      dark_gray: '#555555',
      dark_grey: '#555555',
      blue: '#5555FF',
      green: '#55FF55',
      aqua: '#55FFFF',
      red: '#FF5555',
      light_purple: '#FF55FF',
      yellow: '#FFFF55',
      white: '#FFFFFF'
    };
    
    function parseMinecraftMessage(jsonString) {
      try {
        const data = JSON.parse(jsonString);
        if (!data.extra || !Array.isArray(data.extra)) return jsonString;
        let html = '';
        data.extra.forEach(part => {
          let text = part.text || '';
          text = text.replace(/\n/g, '<br>');
          const cssColor = colorMap[part.color] || part.color || '#FFFFFF';
          const boldStyle = part.bold ? 'font-weight:bold;' : '';
          html += `<span style="color:${cssColor}; ${boldStyle}">${text}</span>`;
        });
        return html;
      } catch (e) {
        return jsonString;
      }
    }
    function renderMessage(message) {
      const prefix = "Kicked: ";
      if (message.startsWith(prefix)) {
        const jsonPart = message.substring(prefix.length);
        return prefix + parseMinecraftMessage(jsonPart);
      }
      return parseMinecraftMessage(message);
    }
    
    // ---------- Previous Usernames and Last Check Info ----------
    function getPrevUsers() {
      const data = getCookie("prevUsers");
      return data ? JSON.parse(data) : {};
    }
    function setPrevUsers(obj) {
      setCookie("prevUsers", JSON.stringify(obj), 7);
    }
    function updatePrevList() {
      const prevUsers = getPrevUsers();
      const prevContainer = document.getElementById("prevContainer");
      const prevList = document.getElementById("prevList");
      prevContainer.style.display = Object.keys(prevUsers).length > 0 ? "block" : "none";
      prevList.innerHTML = "";
      for (let user in prevUsers) {
        const entry = prevUsers[user];
        const div = document.createElement("div");
        div.className = "prevEntry";
        
        // Player head avatar
        const headImg = document.createElement("img");
        headImg.src = "https://minotar.net/helm/" + user;
        headImg.alt = user + "'s head";
        headImg.style.width = "32px";
        headImg.style.height = "32px";
        headImg.style.marginRight = "10px";
        div.appendChild(headImg);
        
        const unameSpan = document.createElement("span");
        unameSpan.className = "prevUsername";
        unameSpan.textContent = user;
        
        const statusSpan = document.createElement("span");
        if (entry.status.startsWith("Not banned") || entry.status === "Unbanned") {
          statusSpan.className = "prevStatus statusNotBanned";
        } else if (entry.status.startsWith("Banned")) {
          statusSpan.className = "prevStatus statusBanned";
        } else if (entry.status.startsWith("Premium Account")) {
          statusSpan.className = "prevStatus statusChecking";
        } else if (entry.status === "Unbanned but player is playing") {
          statusSpan.className = "prevStatus statusLoggedIn";
        } else {
          statusSpan.className = "prevStatus statusChecking";
        }
        statusSpan.textContent = entry.status;
        
        const countSpan = document.createElement("span");
        countSpan.className = "prevCount";
        countSpan.textContent = " Rechecked: " + entry.count;
        
        const recheckButton = document.createElement("button");
        recheckButton.className = "recheckBtn";
        recheckButton.textContent = "Recheck";
        recheckButton.disabled = entry.status.startsWith("Banned") || entry.status.startsWith("Premium Account");
        recheckButton.addEventListener("click", () => {
          document.getElementById("username").value = user;
          document.getElementById("checkBtn").click();
        });
        
        div.appendChild(unameSpan);
        div.appendChild(statusSpan);
        div.appendChild(countSpan);
        div.appendChild(recheckButton);
        prevList.appendChild(div);
      }
    }
    
    function updateLastCheckInfo() {
      const lastUsername = getCookie("lastUsername");
      const lastBanStatus = getCookie("lastBanStatus");
      let displayStatus = lastBanStatus;
      if (lastBanStatus && lastBanStatus.includes("<span")) {
        displayStatus = "The player is currently not banned";
      }
      if (lastUsername) {
        const lastCheckInfo = document.getElementById("lastCheckInfo");
        lastCheckInfo.style.display = "block";
        lastCheckInfo.innerHTML = `
          <strong>Last Checked:</strong> ${lastUsername} <br>
          <strong>Status:</strong> ${displayStatus ? displayStatus : "Unknown"} 
          <br><button id="recheckBtnLast">Re-check</button>
        `;
        document.getElementById("recheckBtnLast").addEventListener("click", () => {
          document.getElementById("username").value = lastUsername;
          document.getElementById("checkBtn").click();
        });
      }
    }
    updateLastCheckInfo();
    updatePrevList();
    
    // ---------- Check Button Event Handler using HTTPS fetch ----------
    const checkBtn = document.getElementById('checkBtn');
    const usernameInput = document.getElementById('username');
    const logList = document.getElementById('logList');
    let currentUsername = "";
    
    usernameInput.addEventListener('keydown', (e) => {
      if (e.key === ' ') e.preventDefault();
    });
    
    checkBtn.addEventListener('click', () => {
      document.getElementById('buttonSound').play().catch(console.error);
      
      const username = usernameInput.value.trim();
      const validUsernameRegex = /^[a-zA-Z0-9_]{3,16}$/;
      if (!validUsernameRegex.test(username)) {
        document.getElementById('errorSound').play().catch(console.error);
        alert("Invalid username. Use only letters, numbers, and underscores (3-16 characters).");
        return;
      }
      currentUsername = username;
      setCookie("lastUsername", username, 7);
      updateLastCheckInfo();
      
      const prevUsers = getPrevUsers();
      if (prevUsers[username]) {
        prevUsers[username].count++;
        prevUsers[username].status = "Checking...";
      } else {
        prevUsers[username] = { count: 1, status: "Checking..." };
      }
      setPrevUsers(prevUsers);
      updatePrevList();
      
      checkBtn.disabled = true;
      checkBtn.textContent = "Please wait 3 seconds...";
      setTimeout(() => { checkBtn.textContent = "Please wait 2 seconds..."; }, 1000);
      setTimeout(() => { checkBtn.textContent = "Please wait 1 second..."; }, 2000);
      setTimeout(() => {
        checkBtn.disabled = false;
        checkBtn.textContent = "Check Status";
      }, 3000);
      
      logList.innerHTML = "";
      fetch('/checkBan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: username })
      })
      .then(response => response.json())
      .then(data => {
        const message = data.message;
        const li = document.createElement('li');
        li.innerHTML = renderMessage(message);
        logList.appendChild(li);
        setCookie("lastBanStatus", message, 7);
        updateLastCheckInfo();
        
        const prevUsers = getPrevUsers();
        let status = "";
        if (message.indexOf('"color":"green","text":"Premium ON') !== -1) {
          status = "Premium Account - Unable To Check. Premium accounts cannot be checked due to BlocksMC restrictions.";
        } else if (message.toLowerCase().includes("you are already logged on to this server")) {
          status = "Unbanned but player is playing";
        } else {
          status = message.toLowerCase().includes("not banned") ? "Not banned" : "Banned";
        }
        if (prevUsers[currentUsername]) {
          prevUsers[currentUsername].status = status;
        }
        setPrevUsers(prevUsers);
        updatePrevList();
        
        if (status === "Not banned" || status === "Unbanned but player is playing") {
          document.getElementById('unbannedSound').play().catch(console.error);
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById('errorSound').play().catch(console.error);
      });
    });
    
    // ---------- Reset Cookies Button ----------
    document.getElementById('resetCookiesBtn').addEventListener('click', function() {
      if (confirm("Warning: This will erase all previous usernames. Continue?")) {
        localStorage.removeItem("prevUsers");
        updatePrevList();
        alert("Previous usernames have been reset.");
      }
    });
  </script>
</body>
</html>
